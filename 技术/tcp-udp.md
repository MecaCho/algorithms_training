# Transmission Control Protocol



# 三次握手

## 1 

```
客户端–发送带有 SYN 标志的数据包–一次握手–服务端
服务端–发送带有 SYN/ACK 标志的数据包–二次握手–客户端
客户端–发送带有带有 ACK 标志的数据包–三次握手–服务端

```

## 2
```
第一步： A 机器向 B机器发出一个数据包并将 SYN 设置为 1 ，表示希望建立连接。这个包中的序列号假设是  X。
第二步： B 机器收到 A机器发过来的数据包后，通过 SYN 得知这是一个建立连接的请求，
于是发送一个响应包并将 SYN 、ACK 标记都置为 1。假设这个包中的序列号是 y ，而确认序列号必须是 x+l ，表示收到了 发过来的 SYN，
TCP 中， SYN 被当作数据部分的一个字节。
第三步： A 收到 的响应包后需进行确认，确认包中将 ACK ，并将确认序列号设置为 y+ ，
表示收到了来自B 的 SYN经过这三步之后，两台服务器就建立连接了，可以进行通信数据传输了。

为什么要三次握手呢？主要是为了信息对等和防止出现请求超时导致脏连接。

```

# 四次挥手

## 1

```
断开一个 TCP 连接则需要“四次挥手”：

客户端-发送一个 FIN，用来关闭客户端到服务器的数据传送
服务器-收到这个 FIN，它发回一 个 ACK，确认序号为收到的序号加1 。和SYN一样，一个FIN将占用一个序号
服务器-关闭与客户端的连接，发送一个FIN给客户端
客户端-发回 ACK 报文确认，并将确认序号设置为收到序号加1
为什么要四次挥手
任何一方都可以在数据传送结束后发出连接释放的通知，待对方确认后进入半关闭状态。
当另一方也没有数据再发送的时候，则发出连接释放通知，对方确认后就完全关闭了TCP连接。
```

# 可靠传输

## 1.确认机制

## 2.超时重传

## 3.拥塞控制

有了TCP的窗口控制，能够连续发生大量数据包，可能会因为其他主机之间的通信导致网络拥堵，
在网络拥堵时，如果突然发送一个较大量的数据，极有可能会导致整个网络的瘫痪，
TCP为了防止这个现象的出现，在通信一开始就会通过一个叫做慢启动的算法得出的数值，对发送数据量进行控制。

### 慢开始、拥塞避免、快重传、快恢复

```
TCP的拥塞控制采用了四种算法，即 慢开始 、 拥塞避免 、快重传 和 快恢复。
在网络层也可以使路由器采用适当的分组丢弃策略（如主动队列管理 AQM），以减少网络拥塞的发生。
```

## 4.流量控制

滑动窗口

```
流量控制
```

# Socket 长连接的实现

背景知识
Socket 长连接，指的是在客户和服务端之间保持一个 socket 连接长时间不断开。
socket.setKeepAlive(true);


# UDP用户数据报协议

UDP 是无连接的。数据报（类似于数据包）只在数据报级别有保证。数据报可能会无序的到达目的地，也有可能会遗失。UDP 不支持拥塞控制。虽然不如 TCP 那样有保证，但 UDP 通常效率更高。

UDP 可以通过广播将数据报发送至子网内的所有设备。这对 DHCP 很有用，因为子网内的设备还没有分配 IP 地址，而 IP 对于 TCP 是必须的。

UDP 可靠性更低但适合用在网络电话、视频聊天，流媒体和实时多人游戏上。

以下情况使用 UDP 代替 TCP：

- 你需要低延迟
- 相对于数据丢失更糟的是数据延迟
- 你想实现自己的错误校正方法