
# 分布式存储

分布式数据库和分布式存储是分布式系统中难度最大、挑战最大，也是最容易出问题的地方。互联网公司只有解决分布式数据存储的问题，才能支撑更多次亿级用户的涌入。


# MYSQL复制

## MySQL的主从复制

将MySQL主数据库中的数据复制到从数据库中去。

实现数据库读写分离，写操作访问主数据库，读操作访问从数据库，从而使数据库具有更强大的访问负载能力，支撑更多的用户访问。

复制原理是：当应用程序客户端发送一条更新命令到数据库的时候，数据库会把这条更新命令同步记录到Binlog中，然后由另外一个线程从Binlog中读取这条日志，然后通过远程通讯的方式将它复制到从服务器上面去，从服务器获得这条更新日志后，将其加入到自己的Relay log中，然后由另外一个SQL执行线程从Relay log中读取这条新的日志，并把它在本地的数据库中重新执行一遍。


## 一主多从复制
  
多个从数据库关联到主数据库后，将主数据库上的Binlog日志同步地复制到了多个从数据库上。

### 一主多从的优点
分摊负载、专机专用、便于冷备和高可用

- 分摊负载

将只读操作分布在多个从数据库上，从而将负载分摊到多台服务器上。

- 专机专用

可以针对不同类型的查询，使用不同的从服务器。

- 便于进行冷备

即使数据库进行了一主多从的复制，在一些极端的情况下。也可能会导致整个数据中心的数据服务器都丢失。所以通常说来很多公司会对数据做冷备，但是进行冷备的时候有一个困难点在于，数据库如果正在进行写操作，冷备的数据就可能不完整，数据文件可能处于损坏状态。使用一主多从的复制就就可以实现零停机时间的备份。只需要关闭数据的数据复制进程，文件就处于关闭状态了，然后进行数据文件拷贝，拷贝完成后再重新打开数据复制就可以了。

- 高可用

如果一台服务器宕机了，只要不发请求给这台服务器就不会出问题。当这台服务器恢复的时候，重新发请求到这台服务器。所以，在一主多从的情况下，某一台从服务器宕机不可用，对整个系统的影响是非常小的。


## 主主复制

解决主服务器的可用性问题

主主复制方案是指两台服务器都当作主服务器，任何一台服务器上收到的写操作都会复制到另一台服务器上。


# MySQL复制注意事项

- 不要对两个数据库同时进行数据写操作，因为这种情况会导致数据冲突。

- 复制只是增加了数据的读并发处理能力，并没有增加写并发的能力和系统存储能力。

- 更新数据表的结构会导致巨大的同步延迟。

需要更新表结构的操作，不要写入到到Binlog中，要关闭更新表结构的Binlog。如果要对表结构进行更新，应该由运维工程师DBA对所有主从数据库分别手工进行数据表结构的更新操作。




