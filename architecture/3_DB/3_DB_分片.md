
# 分片   

- 主要目标：

将一张数据表切分成较小的片，不同的片存储到不同的服务器上面去，
通过分片的方式使用多台服务器存储一张数据表，
避免一台服务器记录存储处理整张数据表带来的存储及访问压力。

- 主要特点：

数据库服务器之间互相独立，不共享任何信息，即使有部分服务器故障，
也不影响整个系统的可用性。
第二个特点是通过分片键定位分片，也就是说一个分片存储到哪个服务器上面去，
到哪个服服务器上面去查找，是通过分片键进行路由分区算法计算出来的。
在SQL语句里面，只要包含分片键，就可以访问特定的服务器，而不需要连接所有的服务器，
跟其他的服务器进行通信。

- 主要原理：

将数据以某种方式进行切分，通常就是用刚才提到的分片键的路由算法。
通过分片键，根据某种路由算法进行计算，使每台服务器都只存储一部分数据。

将数据分配在不同的数据库上，使得每个数据库仅管理整个数据集的一个子集。
以用户数据库为例，随着用户数量的增加，越来越多的分片会被添加到集群中。

类似联合的优点，分片可以减少读取和写入流量，减少复制并提高缓存命中率。
也减少了索引，通常意味着查询更快，性能更好。
如果一个分片出问题，其他的仍能运行，你可以使用某种形式的冗余来防止数据丢失。
类似联合，没有只能串行写入的中心化主库，你可以并行写入，提高负载能力。

常见的做法是用户姓氏的首字母或者用户的地理位置来分隔用户表。

- 不利之处：分片    
你需要修改应用程序的逻辑来实现分片，这会带来复杂的 SQL 查询。        
分片不合理可能导致数据负载不均衡。例如，被频繁访问的用户数据会导致其所在分片的负载相对其他分片高。    
再平衡会引入额外的复杂度。基于一致性哈希的分片算法可以减少这种情况。        
联结多个分片的数据操作更复杂。       
分片需要更多的硬件和额外的复杂度。   

## 水平切分&&垂直切分

- 水平切分: 【单表】的数据量非常多,这时候适合水平切分,即把表的数据按照某种规则(比如按ID散列)切分到多个数据库(server)上
- 垂直切分: 【表多】而数据多,这时候适合使用垂直切分,即把关系紧密(比如同一个模块)的表切分出来放在一个server上,根据业务需要去不同的server请求服务


## 垂直切分

将不同业务模块所使用的表分拆到不同的数据库中。

垂直切分的最大特点就是规则简单，实施也更为方便，
尤其适合各业务之间的耦合度非常低，相互影响很小，业务逻辑非常清晰的系统。

## 水平切分

将同一个表中的不同数据拆分到不同的数据库中

## 混合切分

多数系统会将垂直切分和水平切分联合使用，先对系统做垂直切分，再针对每一小搓表的情况选择性地做水平切分。从而将整个数据库切分成一个分布式矩阵。


