

# 消息模型：主题和队列有什么区别？

1。队列模型----RabbitMQ
2。发布-订阅模型---其他

现代的消息队列产品使用的消息模型大多是这种发布-订阅模型

## RabbitMQ怎么解决多个消费者的问题呢？

RabbitMQ 的一个特色 Exchange 模块
在 RabbitMQ 中，Exchange 位于生产者和队列之间，
生产者并不关心将消息发送给哪个队列，而是将消息发送给 Exchange，
由 Exchange 上配置的策略来决定将消息投递到哪些队列中。

同一份消息如果需要被多个消费者来消费，需要配置 Exchange 将消息发送到多个队列，
每个队列中都存放一份完整的消息数据，可以为一个消费者提供消费服务。
这也可以变相地实现新发布 - 订阅模型中，
“一份消息数据可以被多个订阅者来多次消费”这样的功能。


# 消息事务

消息队列中的“事务”，主要解决的是消息生产者和消息消费者的数据一致性问题。

实际应用中，比较常见的分布式事务实现有 2PC（Two-phase Commit，也叫二阶段提交）、TCC(Try-Confirm-Cancel) 和事务消息


# 如何确保消息不丢失？

根本原因是网络不可达，不可避免
1。发送时消息重复    
2。消费时消费重复

### 解决

保证消息消费业务的幂等

1。唯一id   
2。消费者根据id查询是否消费    
3。消费完毕写入redis/db    
4。如果已经消费就丢弃    

